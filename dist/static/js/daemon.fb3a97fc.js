(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["daemon"],{"28b5":function(t,e,a){"use strict";a("e52d")},e52d:function(t,e,a){},f79e:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-wrapper common-page"},[e("div",{staticClass:"nav-header"},[e("div",{staticClass:"top-link-item"},[e("el-link",{on:{click:function(e){return t.goto("/node/crontab",t.$route.query)}}},[t._v("定时任务")])],1),e("div",{staticClass:"top-link-item active"},[e("el-link",[t._v("常驻任务")])],1)]),e("div",{staticClass:"top-tools"},[e("el-form",{staticClass:"kw-el-form-class",attrs:{inline:!0,size:"small"},on:{submit:function(t){t.preventDefault()}}},[e("el-form-item",{attrs:{label:"关键词"}},[e("el-input",{attrs:{placeholder:"请输入关键词"},model:{value:t.searchForm.keyword,callback:function(e){t.$set(t.searchForm,"keyword",e)},expression:"searchForm.keyword"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("查询")]),e("el-button",{attrs:{type:"text"},on:{click:t.handleReset}},[t._v("清空")])],1)],1)],1),e("div",{staticClass:"table-tools"},[e("div",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.goto("/node/config")}}},[t._v("配置")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.goto("/node/nodeLog")}}},[t._v("日志")])],1),e("div",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.goto("/node/daemonEdit",t.$route.query)}}},[t._v("添加")])],1)]),e("div",{staticClass:"page-table-container"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticClass:"kw-table-data",attrs:{data:t.tableData,border:"",size:"small","row-key":"id"}},[e("el-table-column",{attrs:{prop:"id",label:"任务ID",width:"80px"}}),e("el-table-column",{attrs:{prop:"name",label:"任务名称"}}),e("el-table-column",{attrs:{prop:"dir",label:"执行目录"}}),e("el-table-column",{attrs:{prop:"command",label:"执行命令"}}),e("el-table-column",{attrs:{prop:"run_status",label:"任务状态",width:"120px"}}),e("el-table-column",{attrs:{prop:"create_user",label:"创建人",width:"120px"}}),e("el-table-column",{attrs:{prop:"create_time",label:"创建时间",width:"140px"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s(t.getComputedDate(e.create_time,!0))+" ")]}}])}),e("el-table-column",{attrs:{label:"操作",width:"260px"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"log",expression:"'log'"}],attrs:{type:"text"},on:{click:function(e){return t.showLog(a)}}},[t._v("日志")]),"Unaudited"==a.status?e("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"audit",expression:"'audit'"}],attrs:{type:"text"},on:{click:function(e){return t.handleChangeCommand("audit",a)}}},[t._v("审核")]):t._e(),e("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"edit",expression:"'edit'"}],attrs:{type:"text"},on:{click:function(e){return t.handleChangeCommand("edit",a)}}},[t._v("编辑")]),"Unaudited"!=a.status&&"Timing"!=a.status&&"Running"!=a.status?e("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"start",expression:"'start'"}],attrs:{type:"text"},on:{click:function(e){return t.handleChangeCommand("start",a)}}},[t._v("开启")]):t._e(),"Unaudited"!=a.status&&"Stopped"!=a.status&&"Ok"!=a.status?e("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"stop",expression:"'stop'"}],attrs:{type:"text"},on:{click:function(e){return t.handleChangeCommand("stop",a)}}},[t._v("停止")]):t._e(),e("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"del",expression:"'del'"}],attrs:{type:"text"},on:{click:function(e){return t.handleChangeCommand("del",a)}}},[t._v("删除")])]}}])})],1),e("el-pagination",{attrs:{align:"center","current-page":t.currentPage,"page-sizes":[10,20,50,100],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("el-dialog",{attrs:{title:"任务操作",visible:t.dialogVisible,width:"400px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",[e("el-form",{attrs:{"label-position":"left","label-width":"100px",size:"small"}},[e("el-form-item",{staticStyle:{"margin-bottom":"5px"},attrs:{label:"操作类型"}},[t._v(" "+t._s("audit"==t.dialogForm.type?"审核":"start"==t.dialogForm.type?"开启":"stop"==t.dialogForm.type?"停止":"exec"==t.dialogForm.type?"执行":"del"==t.dialogForm.type?"删除":"kill"==t.dialogForm.type?"强杀":"")+" ")]),e("el-form-item",{staticStyle:{"margin-bottom":"5px"},attrs:{label:"任务ID"}},[t._v(" "+t._s(t.dialogForm.id)+" ")]),e("el-form-item",{staticStyle:{"margin-bottom":"5px"},attrs:{label:"任务名称"}},[t._v(" "+t._s(t.dialogForm.name)+" ")]),e("el-form-item",{staticStyle:{"margin-bottom":"5px"},attrs:{label:"执行目录"}},[t._v(" "+t._s(t.dialogForm.dir)+" ")]),e("el-form-item",{attrs:{label:"执行命令"}},[t._v(" "+t._s(t.dialogForm.command)+" ")])],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary",loading:t.dialogLoading},on:{click:t.dialogSubmit}},[t._v("确 定")])],1)]),e("DaemonDrawer",{attrs:{visible:t.logVisible,detailId:t.logDetailId},on:{"update:visible":function(e){t.logVisible=e}}})],1)},o=[],s=(a("14d9"),function(){var t=this,e=t._self._c;return e("div",[e("el-drawer",{attrs:{title:"任务日志",visible:t.visible,direction:"rtl",size:"1200px","before-close":t.handleClose}},[e("div",[e("el-form",{attrs:{inline:!0}},[e("el-form-item",{attrs:{label:"日期"}},[e("el-date-picker",{attrs:{clearable:!1,type:"date","range-separator":"至","picker-options":t.pickerOptions,"value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchForm.date,callback:function(e){t.$set(t.searchForm,"date",e)},expression:"searchForm.date"}})],1),e("el-form-item",{attrs:{label:"关键词"}},[e("el-input",{model:{value:t.searchForm.keyword,callback:function(e){t.$set(t.searchForm,"keyword",e)},expression:"searchForm.keyword"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.handleSearch}},[t._v("查询")])],1)],1),e("div",{staticClass:"page-table-container"},[e("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.getList,expression:"getList"}],staticClass:"infinite-list",staticStyle:{overflow:"auto"},attrs:{"infinite-scroll-disabled":t.noMore||t.tableLoading}},t._l(t.tableData,(function(a,i){return e("li",{key:i,staticClass:"log-item"},[t._v(t._s(a))])})),0)])],1)])],1)}),l=[],r={props:{visible:Boolean,detailId:Number},data(){return{searchForm:{date:this.getBeforeDay(0),status:"",keyword:""},tableData:[],tableLoading:!1,offset:0,pageSize:10,pickerOptions:this.getElementShortcutOptions(),noMore:!1,statuOptions:[{id:"Error",name:"失败"},{id:"Success",name:"成功"},{id:"Timeout",name:"超时"}]}},watch:{visible(t){t&&this.init()}},methods:{init(){this.offset=0,this.noMore=!1,this.tableData=[],this.clearSearch(),this.getList()},handleClose(){this.$emit("update:visible",!1)},clearSearch(){this.searchForm.keyword="",this.tableData=[],this.offset=0,this.getList()},handleSearch(){this.offset=0,this.tableData=[],this.noMore=!1,this.getList()},getList(){this.tableLoading=!0,this.$api.node.getDaemonLogList({node_id:+this.$route.query.node_id,daemon_id:this.detailId,date:this.searchForm.date,keyword:this.searchForm.keyword||void 0,offset:this.offset,size:this.pageSize}).then(t=>{0==t.code?(this.tableData.push(...t.data.content),this.offset=t.data.offset,(!t.data.content||t.data.content.length<this.pageSize)&&(this.noMore=!0)):this.$message.error(t.msg)}).finally(()=>{this.tableLoading=!1})},getStatusValue(t){const e=this.statuOptions.find(e=>e.id==t);return e?e.name:t}}},n=r,d=(a("28b5"),a("2877")),c=Object(d["a"])(n,s,l,!1,null,"62751234",null),m=c.exports,u={components:{DaemonDrawer:m},data(){return{searchForm:{keyword:""},tableLoading:!1,currentPage:1,pageSize:10,tableData:[{}],total:0,dialogVisible:!1,dialogLoading:!1,dialogForm:{type:"start",id:0,name:"",dir:"",command:""},logVisible:!1,logDetailId:0}},mounted(){this.getList()},activated(){this.getList()},methods:{goto(t,e){this.$router.push({path:t,query:e})},getList(){this.tableLoading=!0,this.$api.node.getDaemonList({node_id:+this.$route.query.node_id,page:this.currentPage,page_size:this.pageSize}).then(t=>{0==t.code?(this.tableData=t.data.list||[],this.total=t.data.total):this.$message.error(t.msg)}).finally(()=>{this.tableLoading=!1})},handleSearch(){this.currentPage=1,this.getList()},handleReset(){this.searchForm.keyword=""},handleSizeChange(t){this.pageSize=t,this.getList()},handleCurrentChange(t){this.currentPage=t,this.getList()},handleChangeCommand(t,e){"edit"==t?this.$router.push({path:"/node/daemonEdit",query:{node_id:this.$route.query.node_id,id:e.id}}):(this.dialogVisible=!0,this.dialogForm={...e,type:t})},dialogSubmit(){this.dialogLoading=!0,this.$api.node[this.dialogForm.type+"Daemon"]({node_id:+this.$route.query.node_id,daemon_ids:[this.dialogForm.id]}).then(t=>{0===t.code?(this.$message.success(t.msg),this.dialogVisible=!1,this.getList()):this.$message.error(t.msg)}).finally(()=>{this.dialogLoading=!1})},showLog(t){this.logVisible=!0,this.logDetailId=t.id}}},h=u,g=Object(d["a"])(h,i,o,!1,null,null,null);e["default"]=g.exports}}]);