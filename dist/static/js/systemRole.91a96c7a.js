(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["systemRole"],{"5d8a":function(e,i,t){"use strict";t.r(i);var s=function(){var e=this,i=e._self._c;return i("div",{staticClass:"page-wrapper common-page"},[i("div",{staticClass:"top-single-title"},[e._v("菜单管理")]),i("div",{staticClass:"top-tools"},[i("div"),i("div",[i("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"add",expression:"'add'"}],attrs:{type:"primary"},on:{click:e.showAddDialog}},[e._v("添加菜单")])],1)]),i("div",{staticClass:"page-table-container"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"kw-table-data",attrs:{data:e.menuList,"row-key":"id",stripe:"","tree-props":{children:"Children"},border:""}},[i("el-table-column",{attrs:{prop:"name",label:"菜单",align:"left","header-align":"center"}}),i("el-table-column",{attrs:{prop:"router",label:"路由",align:"left","header-align":"center"}}),i("el-table-column",{attrs:{prop:"type",label:"客户端",width:"110"},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[e._v(" "+e._s(1===i.type?"仅限web端":2===i.type?"仅限app端":0===i.type?"不限":"")+" ")]}}])}),i("el-table-column",{attrs:{label:"权限",width:"492",align:"left","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._l(t.Permissions,(function(s){return i("el-tag",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"permission",expression:"'permission'"}],key:s.id,attrs:{size:"small",closable:""},on:{close:function(i){return e.handleDelTag(s.id)},click:function(i){return e.editPermissionsDialog(s.id,t.id)}}},[e._v(e._s(s.name))])})),i("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"permission",expression:"'permission'"}],staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(i){return e.showPermissionsDialog(t.id)}}},[e._v("+ 添加权限")])]}}])}),i("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[i("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(i){return e.handleStatusChange(t)}},model:{value:t.status,callback:function(i){e.$set(t,"status",i)},expression:"row.status"}})]}}])}),i("el-table-column",{attrs:{label:"修改时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[e._v(" "+e._s(e.getComputedDate(i.update_time,!0))+" ")]}}])}),i("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[i("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"edit",expression:"'edit'"}],attrs:{type:"text",size:"small"},on:{click:function(i){return e.showEditDialog(t)}}},[e._v("编辑")]),i("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"del",expression:"'del'"}],staticClass:"danger-btn",attrs:{type:"text",size:"small"},on:{click:function(i){return e.delMenu(t.id)}}},[e._v("删除")])]}}])})],1)],1),i("el-dialog",{attrs:{title:e.editForm&&e.editForm.id?"编辑菜单":"新增菜单",visible:e.editDialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(i){e.editDialogVisible=i}},scopedSlots:e._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(i){e.editDialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary",loading:e.dialogSubmitLoading},on:{click:e.dialogSubmit}},[e._v("确 定")])]},proxy:!0}])},[i("div",[i("el-form",{ref:"form",attrs:{"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"菜单名称"}},[i("el-input",{attrs:{placeholder:"请输入菜单名称"},model:{value:e.editForm.name,callback:function(i){e.$set(e.editForm,"name",i)},expression:"editForm.name"}})],1),i("el-form-item",{attrs:{label:"所属菜单"}},[i("el-cascader",{staticClass:"full-input",staticStyle:{width:"100%"},attrs:{options:e.treeList,filterable:"",clearable:"",placeholder:"请选择所属菜单，不选为顶级菜单",props:{checkStrictly:!0,label:"name",value:"id",children:"Children",emitPath:!1}},model:{value:e.editForm.parent_id,callback:function(i){e.$set(e.editForm,"parent_id",i)},expression:"editForm.parent_id"}})],1),i("el-form-item",{attrs:{label:"菜单地址"}},[i("el-input",{attrs:{placeholder:"请输入菜单地址"},model:{value:e.editForm.route,callback:function(i){e.$set(e.editForm,"route",i)},expression:"editForm.route"}})],1),i("el-form-item",{attrs:{label:"菜单状态"}},[i("el-radio",{attrs:{label:1},model:{value:e.editForm.status,callback:function(i){e.$set(e.editForm,"status",i)},expression:"editForm.status"}},[e._v("启用")]),i("el-radio",{attrs:{label:0},model:{value:e.editForm.status,callback:function(i){e.$set(e.editForm,"status",i)},expression:"editForm.status"}},[e._v("禁用")])],1),i("el-form-item",{attrs:{label:"菜单类型"}},[i("el-radio",{attrs:{label:0},model:{value:e.editForm.type,callback:function(i){e.$set(e.editForm,"type",i)},expression:"editForm.type"}},[e._v("不限")]),i("el-radio",{attrs:{label:1},model:{value:e.editForm.type,callback:function(i){e.$set(e.editForm,"type",i)},expression:"editForm.type"}},[e._v("仅限web端")]),i("el-radio",{attrs:{label:2},model:{value:e.editForm.type,callback:function(i){e.$set(e.editForm,"type",i)},expression:"editForm.type"}},[e._v("仅限app端")])],1),i("el-form-item",{attrs:{label:"排序"}},[i("el-input",{attrs:{placeholder:"请输入排序",clearable:""},model:{value:e.editForm.sort,callback:function(i){e.$set(e.editForm,"sort",i)},expression:"editForm.sort"}})],1),i("el-form-item",{attrs:{label:"图标"}},[i("el-input",{attrs:{placeholder:"请输入标识",clearable:""},model:{value:e.editForm.icon,callback:function(i){e.$set(e.editForm,"icon",i)},expression:"editForm.icon"}})],1)],1)],1)]),i("el-dialog",{attrs:{title:e.permissionForm&&e.permissionForm.id?"编辑权限":"新增权限",visible:e.permissionDialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(i){e.permissionDialogVisible=i}},scopedSlots:e._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(i){e.permissionDialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary",loading:e.dialogSubmitLoading},on:{click:e.permissionDialogSubmit}},[e._v("确 定")])]},proxy:!0}])},[i("div",[i("el-form",{ref:"form",attrs:{"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"权限名称"}},[i("el-input",{attrs:{placeholder:"请输入权限名称"},model:{value:e.permissionForm.name,callback:function(i){e.$set(e.permissionForm,"name",i)},expression:"permissionForm.name"}})],1),i("el-form-item",{attrs:{label:"权限标识"}},[i("el-input",{attrs:{placeholder:"请输入权限标识"},model:{value:e.permissionForm.code,callback:function(i){e.$set(e.permissionForm,"code",i)},expression:"permissionForm.code"}})],1),i("el-form-item",{attrs:{label:"分配接口"}},[i("el-cascader",{staticClass:"full-input",staticStyle:{width:"100%"},attrs:{options:e.permissionOptions,filterable:"","collapse-tags":"",placeholder:"请选择接口名称",props:{label:"name",value:"id",emitPath:!1,multiple:!0}},model:{value:e.permissionForm.interface_ids,callback:function(i){e.$set(e.permissionForm,"interface_ids",i)},expression:"permissionForm.interface_ids"}})],1)],1)],1)])],1)},o=[],a={data(){return{menuList:[],treeList:[],tableLoading:!1,editDialogVisible:!1,editForm:{id:void 0,name:"",route:"",parent_id:"",sort:"",status:1,type:0},dialogSubmitLoading:!1,permissionDialogVisible:!1,permissionForm:{id:void 0,name:"",menu_id:"",interface_ids:[],code:""},permissionOptions:[]}},created(){this.getList()},methods:{getList(){this.tableLoading=!0,this.$api.rbac.getMenuList().then(e=>{0===e.code&&(this.menuList=e.data,this.getTreeList(e.data,"treeList"))}).finally(()=>{this.tableLoading=!1})},getTreeList(e,i){const t=e=>{e.forEach(e=>{e.Children&&0==e.Children.length?delete e.Children:e.Children&&t(e.Children)})};let s=JSON.parse(JSON.stringify(e));t(s),this[i]=s},showAddDialog(){this.editDialogVisible=!0,this.editForm={id:void 0,name:"",icon:"",route:"",parent_id:"",sort:"",status:1,type:0}},showEditDialog(e){this.editDialogVisible=!0,this.editForm={id:e.id,name:e.name,icon:e.icon,route:e.router,parent_id:e.parent_id||"",sort:e.sort,status:e.status,type:e.type}},dialogSubmit(){this.editForm.name?(this.editForm.parent_id||(this.editForm.parent_id=0),this.dialogSubmitLoading=!0,this.editForm.sort=+this.editForm.sort,this.editForm.id?this.$api.rbac.editMenu(this.editForm).then(e=>{0===e.code?(this.$message.success(e.msg),this.editDialogVisible=!1,this.getList()):this.$message.error(e.msg)}).finally(()=>{this.dialogSubmitLoading=!1}):this.$api.rbac.addMenu(this.editForm).then(e=>{0===e.code?(this.$message.success(e.msg),this.editDialogVisible=!1,this.getList()):this.$message.error(e.msg)}).finally(()=>{this.dialogSubmitLoading=!1})):this.$message.warning("请输入菜单名称")},delMenu(e){this.$confirm("是否删除该菜单?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$api.rbac.delMenu({id:e}).then(e=>{0===e.code?(this.$message.success(e.msg),this.getList()):this.$message.error(e.msg)})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},showPermissionsDialog(e){this.permissionForm={id:void 0,name:"",menu_id:e,interface_ids:[],code:""},this.permissionDialogVisible=!0,0===this.permissionOptions.length&&this.getPermissionOptions()},editPermissionsDialog(e,i){this.permissionForm={id:e,name:"",menu_id:i,interface_ids:[],code:""},this.permissionDialogVisible=!0,0===this.permissionOptions.length&&this.getPermissionOptions(),this.$api.rbac.getPermission({id:e}).then(e=>{0===e.code&&(this.permissionForm.name=e.data.name,this.permissionForm.code=e.data.code,this.permissionForm.interface_ids=e.data.interfaces.map(e=>"-"+e.id))})},getPermissionOptions(){this.$api.rbac.getInterfaceCategoryList().then(e=>{0===e.code?(this.loopPermission(e.data),this.permissionOptions=e.data):this.$message.error(e.msg)}).finally(()=>{this.pageLoading=!1})},loopPermission(e){e.forEach(e=>{e.interfaces.length>0?e.children=e.interfaces.map(e=>({...e,id:"-"+e.id})):e.children.length>0&&this.loopPermission(e.children)})},permissionDialogSubmit(){this.dialogSubmitLoading=!0,this.permissionForm.id?this.$api.rbac.editPermission({...this.permissionForm,interface_ids:this.permissionForm.interface_ids.map(e=>+e.split("-")[1])}).then(e=>{0===e.code?(this.$message.success(e.msg),this.permissionDialogVisible=!1,this.getList()):this.$message.error(e.msg)}).finally(()=>{this.dialogSubmitLoading=!1}):this.$api.rbac.addPermission({...this.permissionForm,interface_ids:this.permissionForm.interface_ids.map(e=>+e.split("-")[1])}).then(e=>{0===e.code?(this.$message.success(e.msg),this.permissionDialogVisible=!1,this.getList()):this.$message.error(e.msg)}).finally(()=>{this.dialogSubmitLoading=!1})},handleDelTag(e){this.$confirm("是否删除该权限?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$api.rbac.delPermission({id:e}).then(e=>{0===e.code?(this.$message.success(e.msg),this.getList()):this.$message.error(e.msg)})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},handleStatusChange(e){this.$api.rbac.editMenu({id:e.id,parent_id:e.parent_id,route:e.router,sort:e.sort,status:e.status,name:e.name,type:e.type,icon:e.icon}).then(e=>{0===e.code?this.$message.success(e.msg):(this.$message.error(e.msg),this.getList())})}}},l=a,n=(t("922b"),t("2877")),r=Object(n["a"])(l,s,o,!1,null,"17bc0e22",null);i["default"]=r.exports},"922b":function(e,i,t){"use strict";t("dc85")},dc85:function(e,i,t){},f982:function(e,i,t){"use strict";t.r(i);var s=function(){var e=this,i=e._self._c;return i("div",{staticClass:"page-wrapper common-page"},[i("div",{staticClass:"top-single-title"},[e._v("角色管理")]),i("div",{staticClass:"table-tools"},[i("div",[i("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"add",expression:"'add'"}],attrs:{type:"primary"},on:{click:e.showAddDialog}},[i("i",{staticClass:"el-icon-plus"}),e._v("添加角色")])],1)]),i("div",{staticClass:"page-table-container"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"kw-table-data",attrs:{data:e.tableList,"row-key":"id",stripe:"",border:""}},[i("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),i("el-table-column",{attrs:{prop:"name",label:"角色名称"}}),i("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[e._v(" "+e._s(e.getComputedDate(i.create_time,!0))+" ")]}}])}),i("el-table-column",{attrs:{label:"最后更新时间"},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[e._v(" "+e._s(e.getComputedDate(i.update_time,!0))+" ")]}}])}),i("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[i("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"edit",expression:"'edit'"}],attrs:{type:"text",size:"small"},on:{click:function(i){return e.showEditDialog(t)}}},[e._v("编辑")]),i("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"permission",expression:"'permission'"}],attrs:{type:"text",size:"small"},on:{click:function(i){return e.showPermissionDialog(t.id)}}},[e._v("菜单权限")]),i("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"node-permission",expression:"'node-permission'"}],attrs:{type:"text",size:"small"},on:{click:function(i){return e.showNodePermissionDialog(t)}}},[e._v("节点权限")]),i("el-button",{directives:[{name:"getPermission",rawName:"v-getPermission",value:"del",expression:"'del'"}],staticClass:"danger-btn",attrs:{type:"text",size:"small"},on:{click:function(i){return e.delRole(t.id)}}},[e._v("删除")])]}}])})],1)],1),i("el-dialog",{attrs:{title:e.editForm&&e.editForm.id?"编辑角色":"新增角色",visible:e.editDialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(i){e.editDialogVisible=i}},scopedSlots:e._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(i){e.editDialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary",loading:e.dialogSubmitLoading},on:{click:e.dialogSubmit}},[e._v("确 定")])]},proxy:!0}])},[i("div",[i("el-form",{ref:"form",attrs:{"label-width":"80px",size:"small"},on:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"角色名称"}},[i("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.editForm.name,callback:function(i){e.$set(e.editForm,"name",i)},expression:"editForm.name"}})],1)],1)],1)]),i("el-dialog",{attrs:{"destroy-on-close":!0,title:"编辑权限",visible:e.permissionDialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(i){e.permissionDialogVisible=i}},scopedSlots:e._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(i){e.permissionDialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleTreeSubmit}},[e._v("确 定")])]},proxy:!0}])},[i("div",[i("el-tree",{ref:"treeRef",attrs:{data:e.permissionList,"show-checkbox":"",height:300,width:500,"node-key":"id",props:e.treeOptions}})],1)]),i("el-dialog",{attrs:{title:"设置角色节点",visible:e.nodePermissionVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(i){e.nodePermissionVisible=i}},scopedSlots:e._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(i){e.nodePermissionVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary",loading:e.dialogSubmitLoading},on:{click:e.nodeDialogSubmit}},[e._v("确 定")])]},proxy:!0}])},[i("div",[i("el-form",{ref:"form",attrs:{"label-width":"80px",size:"small"},on:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"节点名称"}},[i("el-select",{attrs:{placeholder:"请选择节点",multiple:"",filterable:"",clearable:""},model:{value:e.nodePermissionForm.node_ids,callback:function(i){e.$set(e.nodePermissionForm,"node_ids",i)},expression:"nodePermissionForm.node_ids"}},e._l(e.nodeList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1)])],1)},o=[],a=(t("14d9"),{data(){return{tableList:[],tableLoading:!1,editDialogVisible:!1,editForm:{id:"",name:""},dialogSubmitLoading:!1,permissionDialogVisible:!1,permissionId:"",permissionList:[],selectedPermission:[],treeOptions:{id:"id",label:"name",children:"Children",disabled:"disabled"},nodePermissionForm:{role_id:"",node_ids:[]},nodePermissionVisible:!1,nodeList:[]}},mounted(){this.getList()},methods:{showAddDialog(){this.editDialogVisible=!0,this.editForm={id:void 0,name:""}},showEditDialog(e){this.editDialogVisible=!0,this.editForm={id:e.id,name:e.name}},dialogSubmit(){this.editForm.name?(this.dialogSubmitLoading=!0,this.editForm.id?this.$api.rbac.editRole(this.editForm).then(e=>{0===e.code?(this.$message.success(e.msg),this.editDialogVisible=!1,this.getList()):this.$message.error(e.msg)}).finally(()=>{this.dialogSubmitLoading=!1}):this.$api.rbac.addRole(this.editForm).then(e=>{0===e.code?(this.$message.success(e.msg),this.editDialogVisible=!1,this.getList()):this.$message.error(e.msg)}).finally(()=>{this.dialogSubmitLoading=!1})):this.$message.warning("请输入角色名称")},delRole(e){this.$confirm("是否删除该角色?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$api.rbac.delRole({id:e}).then(e=>{0===e.code?(this.$message.success(e.msg),this.getList()):this.$message.error(e.msg)})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},getList(){this.tableLoading=!0,this.$api.rbac.getRoleList().then(e=>{0===e.code?this.tableList=e.data:this.$message.error(e.msg)}).finally(()=>{this.tableLoading=!1})},showPermissionDialog(e){this.permissionDialogVisible=!0,this.permissionId=e,this.$api.rbac.getRolePermission({role_id:e}).then(e=>{0===e.code&&(this.selectedPermission=[],e.data.forEach(e=>{this.selectedPermission.push(e.menu_id+"-"+e.id)}),this.getTreeOptions())})},getTreeOptions(){this.$api.rbac.getMenuList().then(e=>{0===e.code&&(this.permissionList=e.data,this.getTreeList(e.data),this.$refs.treeRef.setCheckedKeys(this.selectedPermission))}).finally(()=>{this.tableLoading=!1})},getTreeList(e){e&&e.length>0&&e.forEach(e=>{e.Permissions&&e.Permissions.length>0&&(e.Children=e.Permissions),e.menu_id?e.id=e.menu_id+"-"+e.id:e.id=e.id+"",e.Children&&e.Children.length>0?this.getTreeList(e.Children):1==e.check&&this.selectedPermission.push(e.id)})},handleTreeSubmit(){const e=this.$refs.treeRef.getCheckedNodes(!0),i={};e.forEach(e=>{const t=e.id&&e.id.split("-")[1];e.menu_id?i[e.menu_id]?i[e.menu_id].push(+t):i[e.menu_id]=[+t]:e.parent_id&&(i[e.id]=[])}),this.dialogSubmitLoading=!0,this.$api.rbac.setRolePermission({role_id:this.permissionId,permissions:i}).then(e=>{0===e.code?(this.permissionDialogVisible=!1,this.$message.success(e.msg)):this.$message.error(e.msg)}).finally(()=>{this.dialogSubmitLoading=!1})},showNodePermissionDialog(e){this.nodePermissionVisible=!0,this.nodePermissionForm={role_id:e.id,node_ids:e.node_ids||[]},0==this.nodeList.length&&this.getNodeList()},getNodeList(){this.$api.node.getNodeList({page:1,page_size:1e3}).then(e=>{0==e.code?this.nodeList=e.data.list:this.$message.error(e.msg)})},nodeDialogSubmit(){this.dialogSubmitLoading=!0,this.$api.rbac.setRoleNodePermission(this.nodePermissionForm).then(e=>{0==e.code?(this.$message.success(e.msg),this.nodePermissionVisible=!1):this.$message.error(e.msg)}).finally(()=>{this.dialogSubmitLoading=!1})}}}),l=a,n=t("2877"),r=Object(n["a"])(l,s,o,!1,null,null,null);i["default"]=r.exports}}]);